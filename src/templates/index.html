<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Debt Payoff Planner - Pay Off Debt Faster!</title>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css')}}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body class="bg-gradient-to-br from-red-50 to-orange-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple Components
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-lg shadow-md border border-gray-200 p-6 ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, disabled = false, className = "" }) => (
            <button 
                onClick={onClick} 
                disabled={disabled}
                className={`w-full py-3 px-4 rounded-lg font-medium text-white bg-red-600 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors ${className}`}
            >
                {children}
            </button>
        );

        const Input = ({ label, type = "text", value, onChange, placeholder, className = "" }) => (
            <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700">{label}</label>
                <input
                    type={type}
                    value={value}
                    onChange={onChange}
                    placeholder={placeholder}
                    className={`w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent ${className}`}
                />
            </div>
        );

        const Select = ({ label, value, onChange, options }) => (
            <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700">{label}</label>
                <select
                    value={value}
                    onChange={onChange}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
                >
                    {options.map(option => (
                        <option key={option.value} value={option.value}>
                            {option.label}
                        </option>
                    ))}
                </select>
            </div>
        );

        // Step Components
        const Step1Income = ({ monthlyIncome, setMonthlyIncome, onNext }) => (
            <Card>
                <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Step 1: How much money do you have to pay off debt?</h2>
                <div className="max-w-md mx-auto space-y-6">
                    <Input
                        label="Your Monthly Income (after taxes)"
                        type="number"
                        value={monthlyIncome}
                        onChange={(e) => setMonthlyIncome(e.target.value)}
                        placeholder="e.g., 5000"
                    />
                    <div className="text-sm text-gray-600 text-center">
                        üí° This is how much you can put toward debt each month
                    </div>
                    <Button onClick={onNext} disabled={!monthlyIncome}>
                        Next: Add My Debts
                    </Button>
                </div>
            </Card>
        );

        const Step2Debts = ({ debts, setDebts, onNext, onBack }) => {
            const [newDebt, setNewDebt] = useState({ 
                name: "", 
                current_balance: "", 
                interest_rate: "", 
                minimum_payment: "",
                priority: "medium"
            });

            const addDebt = () => {
                if (newDebt.name && newDebt.current_balance && newDebt.interest_rate && newDebt.minimum_payment) {
                    setDebts([...debts, { ...newDebt, id: Date.now() }]);
                    setNewDebt({ 
                        name: "", 
                        current_balance: "", 
                        interest_rate: "", 
                        minimum_payment: "",
                        priority: "medium"
                    });
                }
            };

            const removeDebt = (id) => {
                setDebts(debts.filter(debt => debt.id !== id));
            };

            const totalDebt = debts.reduce((sum, debt) => sum + parseFloat(debt.current_balance || 0), 0);
            const totalMonthlyInterest = debts.reduce((sum, debt) => {
                const balance = parseFloat(debt.current_balance || 0);
                const rate = parseFloat(debt.interest_rate || 0);
                return sum + (balance * rate / 100 / 12);
            }, 0);

            return (
                <Card>
                    <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Step 2: What debts do you have?</h2>
                    
                    <div className="max-w-4xl mx-auto space-y-6">
                        {/* Add New Debt */}
                        <div className="bg-gray-50 p-4 rounded-lg">
                            <h3 className="font-semibold mb-3">Add a new debt:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3">
                                <Input
                                    label="Debt Name"
                                    value={newDebt.name}
                                    onChange={(e) => setNewDebt({...newDebt, name: e.target.value})}
                                    placeholder="e.g., Credit Card"
                                />
                                <Input
                                    label="Current Balance ($)"
                                    type="number"
                                    value={newDebt.current_balance}
                                    onChange={(e) => setNewDebt({...newDebt, current_balance: e.target.value})}
                                    placeholder="5000"
                                />
                                <Input
                                    label="Interest Rate (%)"
                                    type="number"
                                    value={newDebt.interest_rate}
                                    onChange={(e) => setNewDebt({...newDebt, interest_rate: e.target.value})}
                                    placeholder="18.99"
                                />
                                <Input
                                    label="Minimum Payment ($)"
                                    type="number"
                                    value={newDebt.minimum_payment}
                                    onChange={(e) => setNewDebt({...newDebt, minimum_payment: e.target.value})}
                                    placeholder="150"
                                />
                                <Select
                                    label="Priority"
                                    value={newDebt.priority}
                                    onChange={(e) => setNewDebt({...newDebt, priority: e.target.value})}
                                    options={[
                                        { value: "high", label: "üî• High Priority" },
                                        { value: "medium", label: "‚ö° Medium Priority" },
                                        { value: "low", label: "üìå Low Priority" }
                                    ]}
                                />
                            </div>
                            <Button onClick={addDebt} className="mt-3" disabled={!newDebt.name || !newDebt.current_balance || !newDebt.interest_rate || !newDebt.minimum_payment}>
                                Add This Debt
                            </Button>
                        </div>

                        {/* Current Debts */}
                        {debts.length > 0 && (
                            <div>
                                <h3 className="font-semibold mb-3">Your current debts:</h3>
                                <div className="space-y-2">
                                    {debts.map(debt => (
                                        <div key={debt.id} className="flex justify-between items-center bg-white p-3 rounded border">
                                            <div className="flex items-center space-x-3">
                                                <div>
                                                    <span className="font-medium">{debt.name}</span>
                                                    <span className={`ml-2 px-2 py-1 rounded text-xs ${
                                                        debt.priority === 'high' ? 'bg-red-100 text-red-800' :
                                                        debt.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-gray-100 text-gray-800'
                                                    }`}>
                                                        {debt.priority === 'high' ? 'üî• High' : 
                                                         debt.priority === 'medium' ? '‚ö° Medium' : 'üìå Low'}
                                                    </span>
                                                </div>
                                                <div className="text-sm text-gray-500">
                                                    ${debt.current_balance} @ {debt.interest_rate}%
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <span className="text-sm text-gray-500">Min: ${debt.minimum_payment}</span>
                                                <button 
                                                    onClick={() => removeDebt(debt.id)}
                                                    className="text-red-500 hover:text-red-700"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-3 p-3 bg-red-50 rounded">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                        <div>
                                            <div className="text-lg font-bold text-red-600">${totalDebt.toLocaleString()}</div>
                                            <div className="text-sm text-gray-600">Total Debt</div>
                                        </div>
                                        <div>
                                            <div className="text-lg font-bold text-orange-600">${totalMonthlyInterest.toFixed(2)}</div>
                                            <div className="text-sm text-gray-600">Monthly Interest</div>
                                        </div>
                                        <div>
                                            <div className="text-lg font-bold text-blue-600">
                                                ${debts.reduce((sum, debt) => sum + parseFloat(debt.minimum_payment || 0), 0).toLocaleString()}
                                            </div>
                                            <div className="text-sm text-gray-600">Total Min Payments</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                ‚Üê Back
                            </Button>
                            <Button onClick={onNext} disabled={debts.length === 0}>
                                Next: See My Payoff Plan
                            </Button>
                        </div>
                    </div>
                </Card>
            );
        };

        const Step3Results = ({ monthlyIncome, debts, onBack, onRestart }) => {
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('plan');

            useEffect(() => {
                const calculatePlan = async () => {
                    try {
                        const response = await fetch("/allocate", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                monthly_income: parseFloat(monthlyIncome),
                                keep_in_checking: 0,
                                debts: debts,
                                strategy: "avalanche"
                            })
                        });
                        
                        const data = await response.json();
                        if (response.ok) {
                            setResults(data);
                        } else {
                            setResults({ error: data.error || "Something went wrong. Please try again." });
                        }
                    } catch (error) {
                        setResults({ error: "Something went wrong. Please try again." });
                    } finally {
                        setLoading(false);
                    }
                };

                calculatePlan();
            }, [monthlyIncome, debts]);

            if (loading) {
                return (
                    <Card>
                        <div className="text-center py-8">
                            <div className="text-2xl mb-4">ü§î</div>
                            <h2 className="text-xl font-semibold mb-2">Creating your debt payoff plan...</h2>
                            <p className="text-gray-600">This will just take a moment!</p>
                        </div>
                    </Card>
                );
            }

            if (results.error) {
                return (
                    <Card>
                        <div className="text-center py-8">
                            <div className="text-2xl mb-4">‚ö†Ô∏è</div>
                            <h2 className="text-xl font-semibold mb-2">Oops!</h2>
                            <p className="text-gray-600 mb-4">{results.error}</p>
                            <Button onClick={onRestart}>Start Over</Button>
                        </div>
                    </Card>
                );
            }

            const totalDebt = debts.reduce((sum, debt) => sum + parseFloat(debt.current_balance || 0), 0);
            const totalMinPayments = debts.reduce((sum, debt) => sum + parseFloat(debt.minimum_payment || 0), 0);
            const extraPayment = parseFloat(monthlyIncome) - totalMinPayments;

            return (
                <div className="space-y-6">
                    <Card>
                        <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Your Smart Debt Payoff Plan</h2>
                        
                        {/* Tab Navigation */}
                        <div className="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg">
                            <button
                                onClick={() => setActiveTab('plan')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'plan' ? 'bg-white text-red-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                üìã Payoff Plan
                            </button>
                            <button
                                onClick={() => setActiveTab('timeline')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'timeline' ? 'bg-white text-red-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                üìÖ Timeline
                            </button>
                            <button
                                onClick={() => setActiveTab('compare')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'compare' ? 'bg-white text-red-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                ‚öñÔ∏è Compare Strategies
                            </button>
                        </div>

                        {/* Summary Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <div className="text-2xl font-bold text-green-600">${monthlyIncome.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Monthly Income</div>
                            </div>
                            <div className="text-center p-4 bg-red-50 rounded-lg">
                                <div className="text-2xl font-bold text-red-600">${totalDebt.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Total Debt</div>
                            </div>
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <div className="text-2xl font-bold text-blue-600">${totalMinPayments.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Min Payments</div>
                            </div>
                            <div className="text-center p-4 bg-purple-50 rounded-lg">
                                <div className="text-2xl font-bold text-purple-600">${extraPayment.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Extra for Debt</div>
                            </div>
                        </div>

                        {/* Tab Content */}
                        {activeTab === 'plan' && results.allocation && (
                            <div className="space-y-6">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h3 className="font-semibold mb-3">üéØ Your Payoff Strategy: Avalanche Method</h3>
                                    <p className="text-sm text-gray-700">
                                        Pay minimums on all debts, then put extra money toward the debt with the highest interest rate. 
                                        This saves you the most money in interest!
                                    </p>
                                </div>

                                <div>
                                    <h3 className="font-semibold mb-3">üìã Monthly Payment Plan:</h3>
                                    <div className="space-y-3">
                                        {results.allocation.map((debt, index) => (
                                            <div key={index} className="flex justify-between items-center bg-white p-3 rounded border">
                                                <div>
                                                    <span className="font-medium">{debt.name}</span>
                                                    <span className="text-sm text-gray-500 ml-2">
                                                        (${debt.current_balance} @ {debt.interest_rate}%)
                                                    </span>
                                                </div>
                                                <div className="text-right">
                                                    <div className="font-semibold">${debt.allocated}</div>
                                                    <div className="text-sm text-gray-500">
                                                        Min: ${debt.minimum_payment} + Extra: ${(debt.allocated - debt.minimum_payment).toFixed(2)}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {results.total_interest_saved && (
                                    <div className="bg-green-50 p-4 rounded-lg">
                                        <h3 className="font-semibold mb-2">üí∞ Money You'll Save:</h3>
                                        <div className="text-2xl font-bold text-green-600">
                                            ${results.total_interest_saved.toLocaleString()} in interest!
                                        </div>
                                        <p className="text-sm text-gray-600 mt-1">
                                            Compared to making only minimum payments
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'timeline' && (
                            <div className="space-y-6">
                                <div className="bg-yellow-50 p-4 rounded-lg">
                                    <h3 className="font-semibold mb-3">üìÖ When Will You Be Debt Free?</h3>
                                    <p className="text-sm text-gray-700">
                                        This shows how long it will take to pay off all your debts with this plan.
                                    </p>
                                </div>

                                <div className="space-y-4">
                                    {results.timeline && results.timeline.map((month, index) => (
                                        <div key={index} className="bg-white p-4 rounded border">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-semibold">Month {month.month}</h4>
                                                <span className="text-sm text-gray-500">
                                                    ${month.total_remaining.toLocaleString()} remaining
                                                </span>
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                {month.debts_paid_off.length > 0 && (
                                                    <div className="mb-2">
                                                        <span className="text-green-600 font-medium">‚úì Paid off:</span> {month.debts_paid_off.join(', ')}
                                                    </div>
                                                )}
                                                <div className="text-sm">
                                                    Interest paid this month: ${month.interest_paid.toFixed(2)}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'compare' && (
                            <div className="space-y-6">
                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <h3 className="font-semibold mb-3">‚öñÔ∏è Compare Different Payoff Strategies</h3>
                                    <p className="text-sm text-gray-700">
                                        See how different approaches affect your payoff timeline and total interest paid.
                                    </p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {results.strategy_comparison && Object.entries(results.strategy_comparison).map(([strategy, data]) => (
                                        <div key={strategy} className="bg-white p-4 rounded border">
                                            <h4 className="font-semibold mb-2">
                                                {strategy === 'avalanche' ? 'üî• Avalanche' :
                                                 strategy === 'snowball' ? '‚ùÑÔ∏è Snowball' :
                                                 'üéØ Hybrid'}
                                            </h4>
                                            <div className="space-y-2 text-sm">
                                                <div>
                                                    <span className="text-gray-600">Total Interest:</span>
                                                    <span className="font-medium ml-1">${data.total_interest.toLocaleString()}</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Payoff Time:</span>
                                                    <span className="font-medium ml-1">{data.months_to_payoff} months</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Interest Saved:</span>
                                                    <span className="font-medium ml-1 text-green-600">${data.interest_saved.toLocaleString()}</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                ‚Üê Back to Debts
                            </Button>
                            <Button onClick={onRestart} className="bg-green-600 hover:bg-green-700">
                                Start Over
                            </Button>
                        </div>
                    </Card>
                </div>
            );
        };

        // Main App
        function App() {
            const [step, setStep] = useState(1);
            const [monthlyIncome, setMonthlyIncome] = useState("");
            const [debts, setDebts] = useState([]);

            const nextStep = () => setStep(step + 1);
            const prevStep = () => setStep(step - 1);
            const restart = () => {
                setStep(1);
                setMonthlyIncome("");
                setDebts([]);
            };

            return (
                <div className="container mx-auto px-4 py-8">
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-4xl font-bold text-gray-900 mb-4">
                            üí≥ Smart Debt Payoff Planner
                        </h1>
                        <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                            Pay off your debts faster and save thousands in interest with smart strategies
                        </p>
                    </div>

                    {/* Progress Bar */}
                    <div className="max-w-2xl mx-auto mb-8">
                        <div className="flex items-center justify-between">
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${
                                step >= 1 ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-500'
                            }`}>1</div>
                            <div className={`flex-1 h-1 ${step >= 2 ? 'bg-red-600' : 'bg-gray-200'}`}></div>
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${
                                step >= 2 ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-500'
                            }`}>2</div>
                            <div className={`flex-1 h-1 ${step >= 3 ? 'bg-red-600' : 'bg-gray-200'}`}></div>
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${
                                step >= 3 ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-500'
                            }`}>3</div>
                        </div>
                        <div className="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Income</span>
                            <span>Debts</span>
                            <span>Plan</span>
                        </div>
                    </div>

                    {/* Step Content */}
                    {step === 1 && <Step1Income monthlyIncome={monthlyIncome} setMonthlyIncome={setMonthlyIncome} onNext={nextStep} />}
                    {step === 2 && <Step2Debts debts={debts} setDebts={setDebts} onNext={nextStep} onBack={prevStep} />}
                    {step === 3 && <Step3Results monthlyIncome={monthlyIncome} debts={debts} onBack={prevStep} onRestart={restart} />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>