<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Financial Planner - Real-World Money Management</title>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css')}}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple Components
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-lg shadow-md border border-gray-200 p-6 ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, disabled = false, className = "" }) => (
            <button 
                onClick={onClick} 
                disabled={disabled}
                className={`w-full py-3 px-4 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors ${className}`}
            >
                {children}
            </button>
        );

        const Input = ({ label, type = "text", value, onChange, placeholder, className = "" }) => (
            <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700">{label}</label>
                <input
                    type={type}
                    value={value}
                    onChange={onChange}
                    placeholder={placeholder}
                    className={`w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ${className}`}
                />
            </div>
        );

        const Select = ({ label, value, onChange, options }) => (
            <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700">{label}</label>
                <select
                    value={value}
                    onChange={onChange}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                    {options.map(option => (
                        <option key={option.value} value={option.value}>
                            {option.label}
                        </option>
                    ))}
                </select>
            </div>
        );

        // Step Components
        const Step1Income = ({ financialData, setFinancialData, onNext }) => (
            <Card>
                <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Step 1: Your Income & Savings</h2>
                <div className="max-w-4xl mx-auto space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <Input
                            label="Monthly Income (after taxes)"
                            type="number"
                            value={financialData.monthly_income || ""}
                            onChange={(e) => setFinancialData({...financialData, monthly_income: e.target.value})}
                            placeholder="e.g., 5000"
                        />
                        <Input
                            label="Current Savings"
                            type="number"
                            value={financialData.current_savings || ""}
                            onChange={(e) => setFinancialData({...financialData, current_savings: e.target.value})}
                            placeholder="e.g., 10000"
                        />
                    </div>
                    
                    <div className="bg-blue-50 p-4 rounded-lg">
                        <h3 className="font-semibold mb-3">💡 Income Changes (Optional)</h3>
                        <p className="text-sm text-gray-600 mb-4">Add expected changes to your income over the next 12 months</p>
                        <IncomeChangesList 
                            incomeChanges={financialData.income_changes || []}
                            setIncomeChanges={(changes) => setFinancialData({...financialData, income_changes: changes})}
                        />
                    </div>

                    <div className="bg-green-50 p-4 rounded-lg">
                        <h3 className="font-semibold mb-3">🎯 Emergency Fund Target</h3>
                        <p className="text-sm text-gray-600 mb-3">How much do you want in your emergency fund?</p>
                        <Input
                            label="Emergency Fund Target (months of income)"
                            type="number"
                            value={financialData.emergency_fund_months || "6"}
                            onChange={(e) => setFinancialData({...financialData, emergency_fund_months: e.target.value})}
                            placeholder="6"
                        />
                    </div>

                    <Button onClick={onNext} disabled={!financialData.monthly_income}>
                        Next: Add Your Debts
                    </Button>
                </div>
            </Card>
        );

        const IncomeChangesList = ({ incomeChanges, setIncomeChanges }) => {
            const [newChange, setNewChange] = useState({
                name: "",
                type: "percentage",
                amount: "",
                start_month: ""
            });

            const addChange = () => {
                if (newChange.name && newChange.amount && newChange.start_month) {
                    setIncomeChanges([...incomeChanges, { ...newChange, id: Date.now() }]);
                    setNewChange({ name: "", type: "percentage", amount: "", start_month: "" });
                }
            };

            const removeChange = (id) => {
                setIncomeChanges(incomeChanges.filter(change => change.id !== id));
            };

            return (
                <div className="space-y-4">
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                        <Input
                            label="Description"
                            value={newChange.name}
                            onChange={(e) => setNewChange({...newChange, name: e.target.value})}
                            placeholder="e.g., New client"
                        />
                        <Select
                            label="Type"
                            value={newChange.type}
                            onChange={(e) => setNewChange({...newChange, type: e.target.value})}
                            options={[
                                { value: "percentage", label: "Percentage Increase" },
                                { value: "fixed", label: "Fixed Amount" },
                                { value: "one_time", label: "One-time Bonus" }
                            ]}
                        />
                        <Input
                            label={newChange.type === "percentage" ? "Percentage" : "Amount ($)"}
                            type="number"
                            value={newChange.amount}
                            onChange={(e) => setNewChange({...newChange, amount: e.target.value})}
                            placeholder={newChange.type === "percentage" ? "20" : "1000"}
                        />
                        <Input
                            label="Start Month"
                            type="number"
                            value={newChange.start_month}
                            onChange={(e) => setNewChange({...newChange, start_month: e.target.value})}
                            placeholder="3"
                        />
                    </div>
                    <Button onClick={addChange} className="bg-green-600 hover:bg-green-700" disabled={!newChange.name || !newChange.amount || !newChange.start_month}>
                        Add Income Change
                    </Button>

                    {incomeChanges.length > 0 && (
                        <div className="space-y-2">
                            <h4 className="font-medium">Planned Changes:</h4>
                            {incomeChanges.map(change => (
                                <div key={change.id} className="flex justify-between items-center bg-white p-3 rounded border">
                                    <div>
                                        <span className="font-medium">{change.name}</span>
                                                                                <span className="text-sm text-gray-500 ml-2">
                                            {change.type === "percentage" ? change.amount + "%" :
                                             change.type === "fixed" ? "+$" + change.amount :
                                             "$" + change.amount + " bonus"} starting month {change.start_month}
                                        </span>
                                    </div>
                                    <button 
                                        onClick={() => removeChange(change.id)}
                                        className="text-red-500 hover:text-red-700"
                                    >
                                        ✕
                                    </button>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const Step2Debts = ({ financialData, setFinancialData, onNext, onBack }) => {
            const [newDebt, setNewDebt] = useState({ 
                name: "", 
                current_balance: "", 
                interest_rate: "", 
                minimum_payment: "",
                priority: "medium"
            });

            const addDebt = () => {
                if (newDebt.name && newDebt.current_balance && newDebt.interest_rate && newDebt.minimum_payment) {
                    setFinancialData({
                        ...financialData, 
                        debts: [...(financialData.debts || []), { ...newDebt, id: Date.now() }]
                    });
                    setNewDebt({ 
                        name: "", 
                        current_balance: "", 
                        interest_rate: "", 
                        minimum_payment: "",
                        priority: "medium"
                    });
                }
            };

            const removeDebt = (id) => {
                setFinancialData({
                    ...financialData,
                    debts: (financialData.debts || []).filter(debt => debt.id !== id)
                });
            };

            const totalDebt = (financialData.debts || []).reduce((sum, debt) => sum + parseFloat(debt.current_balance || 0), 0);
            const totalMonthlyInterest = (financialData.debts || []).reduce((sum, debt) => {
                const balance = parseFloat(debt.current_balance || 0);
                const rate = parseFloat(debt.interest_rate || 0);
                return sum + (balance * rate / 100 / 12);
            }, 0);

            return (
                <Card>
                    <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Step 2: Your Debts</h2>
                    
                    <div className="max-w-4xl mx-auto space-y-6">
                        <div className="bg-red-50 p-4 rounded-lg">
                            <h3 className="font-semibold mb-3">Add a new debt:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3">
                                <Input
                                    label="Debt Name"
                                    value={newDebt.name}
                                    onChange={(e) => setNewDebt({...newDebt, name: e.target.value})}
                                    placeholder="e.g., Credit Card"
                                />
                                <Input
                                    label="Current Balance ($)"
                                    type="number"
                                    value={newDebt.current_balance}
                                    onChange={(e) => setNewDebt({...newDebt, current_balance: e.target.value})}
                                    placeholder="5000"
                                />
                                <Input
                                    label="Interest Rate (%)"
                                    type="number"
                                    value={newDebt.interest_rate}
                                    onChange={(e) => setNewDebt({...newDebt, interest_rate: e.target.value})}
                                    placeholder="18.99"
                                />
                                <Input
                                    label="Minimum Payment ($)"
                                    type="number"
                                    value={newDebt.minimum_payment}
                                    onChange={(e) => setNewDebt({...newDebt, minimum_payment: e.target.value})}
                                    placeholder="150"
                                />
                                <Select
                                    label="Priority"
                                    value={newDebt.priority}
                                    onChange={(e) => setNewDebt({...newDebt, priority: e.target.value})}
                                    options={[
                                        { value: "high", label: "🔥 High Priority" },
                                        { value: "medium", label: "⚡ Medium Priority" },
                                        { value: "low", label: "📌 Low Priority" }
                                    ]}
                                />
                            </div>
                            <Button onClick={addDebt} className="mt-3 bg-red-600 hover:bg-red-700" disabled={!newDebt.name || !newDebt.current_balance || !newDebt.interest_rate || !newDebt.minimum_payment}>
                                Add This Debt
                            </Button>
                        </div>

                        {(financialData.debts || []).length > 0 && (
                            <div>
                                <h3 className="font-semibold mb-3">Your current debts:</h3>
                                <div className="space-y-2">
                                    {(financialData.debts || []).map(debt => (
                                        <div key={debt.id} className="flex justify-between items-center bg-white p-3 rounded border">
                                            <div className="flex items-center space-x-3">
                                                <div>
                                                    <span className="font-medium">{debt.name}</span>
                                                    <span className={`ml-2 px-2 py-1 rounded text-xs ${
                                                        debt.priority === 'high' ? 'bg-red-100 text-red-800' :
                                                        debt.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                        'bg-gray-100 text-gray-800'
                                                    }`}>
                                                        {debt.priority === 'high' ? '🔥 High' : 
                                                         debt.priority === 'medium' ? '⚡ Medium' : '📌 Low'}
                                                    </span>
                                                </div>
                                                <div className="text-sm text-gray-500">
                                                    ${debt.current_balance} @ {debt.interest_rate}%
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <span className="text-sm text-gray-500">Min: ${debt.minimum_payment}</span>
                                                <button 
                                                    onClick={() => removeDebt(debt.id)}
                                                    className="text-red-500 hover:text-red-700"
                                                >
                                                    ✕
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-3 p-3 bg-red-50 rounded">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                        <div>
                                            <div className="text-lg font-bold text-red-600">${totalDebt.toLocaleString()}</div>
                                            <div className="text-sm text-gray-600">Total Debt</div>
                                        </div>
                                        <div>
                                            <div className="text-lg font-bold text-orange-600">${totalMonthlyInterest.toFixed(2)}</div>
                                            <div className="text-sm text-gray-600">Monthly Interest</div>
                                        </div>
                                        <div>
                                            <div className="text-lg font-bold text-blue-600">
                                                ${(financialData.debts || []).reduce((sum, debt) => sum + parseFloat(debt.minimum_payment || 0), 0).toLocaleString()}
                                            </div>
                                            <div className="text-sm text-gray-600">Total Min Payments</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                ← Back
                            </Button>
                            <Button onClick={onNext}>
                                Next: Add Your Expenses
                            </Button>
                        </div>
                    </div>
                </Card>
            );
        };

        const Step3Expenses = ({ financialData, setFinancialData, onNext, onBack }) => {
            const [expenseCategories, setExpenseCategories] = useState({});
            const [newExpense, setNewExpense] = useState({ 
                name: "", 
                category: "housing",
                amount: "",
                flexible: true
            });

            useEffect(() => {
                fetch('/expense-categories')
                    .then(res => res.json())
                    .then(data => setExpenseCategories(data))
                    .catch(err => console.error('Error loading categories:', err));
            }, []);

            const addExpense = () => {
                if (newExpense.name && newExpense.amount) {
                    setFinancialData({
                        ...financialData, 
                        expenses: [...(financialData.expenses || []), { ...newExpense, id: Date.now() }]
                    });
                    setNewExpense({ 
                        name: "", 
                        category: "housing",
                        amount: "",
                        flexible: true
                    });
                }
            };

            const removeExpense = (id) => {
                setFinancialData({
                    ...financialData,
                    expenses: (financialData.expenses || []).filter(expense => expense.id !== id)
                });
            };

            const totalExpenses = (financialData.expenses || []).reduce((sum, expense) => sum + parseFloat(expense.amount || 0), 0);

            return (
                <Card>
                    <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Step 3: Your Monthly Expenses</h2>
                    
                    <div className="max-w-4xl mx-auto space-y-6">
                        <div className="bg-green-50 p-4 rounded-lg">
                            <h3 className="font-semibold mb-3">Add a new expense:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                                <Input
                                    label="Expense Name"
                                    value={newExpense.name}
                                    onChange={(e) => setNewExpense({...newExpense, name: e.target.value})}
                                    placeholder="e.g., Rent"
                                />
                                <Select
                                    label="Category"
                                    value={newExpense.category}
                                    onChange={(e) => setNewExpense({...newExpense, category: e.target.value})}
                                    options={Object.entries(expenseCategories).map(([key, cat]) => ({
                                        value: key,
                                        label: cat.icon + " " + cat.name
                                    }))}
                                />
                                <Input
                                    label="Monthly Amount ($)"
                                    type="number"
                                    value={newExpense.amount}
                                    onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})}
                                    placeholder="1200"
                                />
                                <div className="flex items-center space-x-2">
                                    <input
                                        type="checkbox"
                                        id="flexible"
                                        checked={newExpense.flexible}
                                        onChange={(e) => setNewExpense({...newExpense, flexible: e.target.checked})}
                                        className="rounded"
                                    />
                                    <label htmlFor="flexible" className="text-sm text-gray-700">Flexible Expense</label>
                                </div>
                            </div>
                            <Button onClick={addExpense} className="mt-3 bg-green-600 hover:bg-green-700" disabled={!newExpense.name || !newExpense.amount}>
                                Add This Expense
                            </Button>
                        </div>

                        {(financialData.expenses || []).length > 0 && (
                            <div>
                                <h3 className="font-semibold mb-3">Your monthly expenses:</h3>
                                <div className="space-y-2">
                                    {(financialData.expenses || []).map(expense => (
                                        <div key={expense.id} className="flex justify-between items-center bg-white p-3 rounded border">
                                            <div className="flex items-center space-x-3">
                                                <div>
                                                    <span className="font-medium">{expense.name}</span>
                                                    <span className="text-sm text-gray-500 ml-2">
                                                        {expenseCategories[expense.category]?.name || expense.category}
                                                    </span>
                                                    {expense.flexible && (
                                                        <span className="ml-2 px-2 py-1 rounded text-xs bg-blue-100 text-blue-800">
                                                            Flexible
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <span className="font-semibold">${expense.amount}</span>
                                                <button 
                                                    onClick={() => removeExpense(expense.id)}
                                                    className="text-red-500 hover:text-red-700"
                                                >
                                                    ✕
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-3 p-3 bg-green-50 rounded">
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-green-600">${totalExpenses.toLocaleString()}</div>
                                        <div className="text-sm text-gray-600">Total Monthly Expenses</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                ← Back
                            </Button>
                            <Button onClick={onNext}>
                                Next: Add Your Goals
                            </Button>
                        </div>
                    </div>
                </Card>
            );
        };

        const Step4Goals = ({ financialData, setFinancialData, onNext, onBack }) => {
            const [newGoal, setNewGoal] = useState({ 
                name: "", 
                type: "savings",
                target_amount: "",
                target_month: ""
            });

            const addGoal = () => {
                if (newGoal.name && newGoal.target_amount && newGoal.target_month) {
                    setFinancialData({
                        ...financialData, 
                        goals: [...(financialData.goals || []), { ...newGoal, id: Date.now() }]
                    });
                    setNewGoal({ 
                        name: "", 
                        type: "savings",
                        target_amount: "",
                        target_month: ""
                    });
                }
            };

            const removeGoal = (id) => {
                setFinancialData({
                    ...financialData,
                    goals: (financialData.goals || []).filter(goal => goal.id !== id)
                });
            };

            return (
                <Card>
                    <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Step 4: Your Financial Goals</h2>
                    
                    <div className="max-w-4xl mx-auto space-y-6">
                        <div className="bg-purple-50 p-4 rounded-lg">
                            <h3 className="font-semibold mb-3">Add a new goal:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                                <Input
                                    label="Goal Name"
                                    value={newGoal.name}
                                    onChange={(e) => setNewGoal({...newGoal, name: e.target.value})}
                                    placeholder="e.g., Buy a car"
                                />
                                <Select
                                    label="Goal Type"
                                    value={newGoal.type}
                                    onChange={(e) => setNewGoal({...newGoal, type: e.target.value})}
                                    options={[
                                        { value: "savings", label: "💰 Savings Goal" },
                                        { value: "debt_payoff", label: "💳 Debt Payoff" },
                                        { value: "purchase", label: "🛒 Major Purchase" }
                                    ]}
                                />
                                <Input
                                    label="Target Amount ($)"
                                    type="number"
                                    value={newGoal.target_amount}
                                    onChange={(e) => setNewGoal({...newGoal, target_amount: e.target.value})}
                                    placeholder="25000"
                                />
                                <Input
                                    label="Target Month"
                                    type="number"
                                    value={newGoal.target_month}
                                    onChange={(e) => setNewGoal({...newGoal, target_month: e.target.value})}
                                    placeholder="6"
                                />
                            </div>
                            <Button onClick={addGoal} className="mt-3 bg-purple-600 hover:bg-purple-700" disabled={!newGoal.name || !newGoal.target_amount || !newGoal.target_month}>
                                Add This Goal
                            </Button>
                        </div>

                        {(financialData.goals || []).length > 0 && (
                            <div>
                                <h3 className="font-semibold mb-3">Your financial goals:</h3>
                                <div className="space-y-2">
                                    {(financialData.goals || []).map(goal => (
                                        <div key={goal.id} className="flex justify-between items-center bg-white p-3 rounded border">
                                            <div className="flex items-center space-x-3">
                                                <div>
                                                    <span className="font-medium">{goal.name}</span>
                                                    <span className="text-sm text-gray-500 ml-2">
                                                        {goal.type === 'savings' ? '💰 Savings' : 
                                                         goal.type === 'debt_payoff' ? '💳 Debt Payoff' : '🛒 Purchase'}
                                                    </span>
                                                </div>
                                                <div className="text-sm text-gray-500">
                                                    ${goal.target_amount} by month {goal.target_month}
                                                </div>
                                            </div>
                                            <button 
                                                onClick={() => removeGoal(goal.id)}
                                                className="text-red-500 hover:text-red-700"
                                            >
                                                ✕
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                ← Back
                            </Button>
                            <Button onClick={onNext}>
                                Generate My Financial Plan
                            </Button>
                        </div>
                    </div>
                </Card>
            );
        };

        const Step5Results = ({ financialData, onBack, onRestart }) => {
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('summary');

            useEffect(() => {
                const calculatePlan = async () => {
                    try {
                        const response = await fetch("/calculate-plan", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                ...financialData,
                                emergency_fund_target: (financialData.monthly_income || 0) * (financialData.emergency_fund_months || 6)
                            })
                        });
                        
                        const data = await response.json();
                        if (response.ok) {
                            setResults(data);
                        } else {
                            setResults({ error: data.error || "Something went wrong. Please try again." });
                        }
                    } catch (error) {
                        setResults({ error: "Something went wrong. Please try again." });
                    } finally {
                        setLoading(false);
                    }
                };

                calculatePlan();
            }, [financialData]);

            if (loading) {
                return (
                    <Card>
                        <div className="text-center py-8">
                            <div className="text-2xl mb-4">🤔</div>
                            <h2 className="text-xl font-semibold mb-2">Creating your comprehensive financial plan...</h2>
                            <p className="text-gray-600">This will just take a moment!</p>
                        </div>
                    </Card>
                );
            }

            if (results.error) {
                return (
                    <Card>
                        <div className="text-center py-8">
                            <div className="text-2xl mb-4">⚠️</div>
                            <h2 className="text-xl font-semibold mb-2">Oops!</h2>
                            <p className="text-gray-600 mb-4">{results.error}</p>
                            <div className="flex space-x-3 justify-center">
                                <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                    ← Back to Goals
                                </Button>
                                <Button onClick={onRestart} className="bg-green-600 hover:bg-green-700">
                                    Start Over
                                </Button>
                            </div>
                        </div>
                    </Card>
                );
            }

            return (
                <div className="space-y-6">
                    <Card>
                        <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">Your Comprehensive Financial Plan</h2>
                        
                        {/* Financial Health Score */}
                        <div className="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg mb-6">
                            <div className="text-center">
                                <div className="text-4xl font-bold mb-2">{results.summary.financial_health_score}/100</div>
                                <div className="text-lg">Financial Health Score</div>
                                <div className="text-sm opacity-90 mt-2">
                                    {results.summary.financial_health_score >= 80 ? "Excellent! You're in great financial shape!" :
                                     results.summary.financial_health_score >= 60 ? "Good! You're on the right track!" :
                                     results.summary.financial_health_score >= 40 ? "Fair. There's room for improvement." :
                                     "Needs attention. Let's work on improving your financial health."}
                                </div>
                            </div>
                        </div>

                        {/* Summary Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <div className="text-2xl font-bold text-green-600">${results.summary.monthly_income.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Monthly Income</div>
                            </div>
                            <div className="text-center p-4 bg-red-50 rounded-lg">
                                <div className="text-2xl font-bold text-red-600">${results.summary.total_debt.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Total Debt</div>
                            </div>
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <div className="text-2xl font-bold text-blue-600">${results.summary.total_current_expenses.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Monthly Expenses</div>
                            </div>
                            <div className="text-center p-4 bg-purple-50 rounded-lg">
                                <div className="text-2xl font-bold text-purple-600">${results.summary.available_funds.toLocaleString()}</div>
                                <div className="text-sm text-gray-600">Available Funds</div>
                            </div>
                        </div>

                        {/* Tab Navigation */}
                        <div className="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg">
                            <button
                                onClick={() => setActiveTab('summary')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'summary' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                📊 Summary
                            </button>
                            <button
                                onClick={() => setActiveTab('projection')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'projection' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                📈 12-Month Projection
                            </button>
                            <button
                                onClick={() => setActiveTab('strategies')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'strategies' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                ⚖️ Debt Strategies
                            </button>
                            <button
                                onClick={() => setActiveTab('recommendations')}
                                className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                                    activeTab === 'recommendations' ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600 hover:text-gray-900'
                                }`}
                            >
                                💡 Recommendations
                            </button>
                        </div>

                        {/* Tab Content */}
                        {activeTab === 'summary' && (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h3 className="font-semibold mb-3">💰 Emergency Fund Status</h3>
                                        <div className="text-2xl font-bold text-blue-600 mb-2">
                                            ${results.summary.current_savings.toLocaleString()}
                                        </div>
                                        <div className="text-sm text-gray-600">
                                            Target: ${results.summary.emergency_fund_target.toLocaleString()}
                                        </div>
                                        <div className="mt-2">
                                            <div className="w-full bg-gray-200 rounded-full h-2">
                                                <div 
                                                    className="bg-blue-600 h-2 rounded-full" 
                                                    style={{"width": Math.min(100, (results.summary.current_savings / results.summary.emergency_fund_target) * 100) + "%"}}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-green-50 p-4 rounded-lg">
                                        <h3 className="font-semibold mb-3">📊 Key Ratios</h3>
                                        <div className="space-y-2">
                                            <div className="flex justify-between">
                                                <span>Debt-to-Income:</span>
                                                <span className="font-semibold">{((results.summary.total_debt / results.summary.monthly_income) * 100).toFixed(1)}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span>Expense Ratio:</span>
                                                <span className="font-semibold">{((results.summary.total_current_expenses / results.summary.monthly_income) * 100).toFixed(1)}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span>Savings Rate:</span>
                                                <span className="font-semibold">{((results.summary.available_funds / results.summary.monthly_income) * 100).toFixed(1)}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'projection' && (
                            <div className="space-y-6">
                                <div className="bg-yellow-50 p-4 rounded-lg">
                                    <h3 className="font-semibold mb-3">📈 12-Month Financial Projection</h3>
                                    <p className="text-sm text-gray-700">
                                        This shows how your finances will evolve over the next year based on your current plan.
                                    </p>
                                </div>

                                <div className="space-y-4">
                                    {results.projection.map((month, index) => (
                                        <div key={index} className="bg-white p-4 rounded border">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-semibold">Month {month.month}</h4>
                                                <span className="text-sm text-gray-500">
                                                    Income: ${month.income.toLocaleString()}
                                                </span>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                                                <div>
                                                    <span className="text-gray-600">Expenses:</span>
                                                    <div className="font-semibold">${month.expenses.toLocaleString()}</div>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Savings:</span>
                                                    <div className="font-semibold text-green-600">${month.savings.toLocaleString()}</div>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Balance:</span>
                                                    <div className="font-semibold">${month.current_balance.toLocaleString()}</div>
                                                </div>
                                                <div>
                                                    <span className="text-gray-600">Debt Remaining:</span>
                                                    <div className="font-semibold text-red-600">${month.total_debt_remaining.toLocaleString()}</div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'strategies' && (
                            <div className="space-y-6">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h3 className="font-semibold mb-3">⚖️ Debt Payoff Strategy Comparison</h3>
                                    <p className="text-sm text-gray-700">
                                        Compare different approaches to paying off your debt.
                                    </p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {Object.entries(results.debt_strategies).map(([strategy, data]) => (
                                        <div key={strategy} className="bg-white p-4 rounded border">
                                            <h4 className="font-semibold mb-2 capitalize">
                                                {strategy === 'avalanche' ? '🔥 Avalanche' : 
                                                 strategy === 'snowball' ? '❄️ Snowball' : '⚖️ Equal Payment'}
                                            </h4>
                                            <div className="space-y-2 text-sm">
                                                <div className="flex justify-between">
                                                    <span>Months to Payoff:</span>
                                                    <span className="font-semibold">{data.months_to_payoff}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Total Interest:</span>
                                                    <span className="font-semibold">${data.total_interest.toLocaleString()}</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'recommendations' && (
                            <div className="space-y-6">
                                <div className="bg-green-50 p-4 rounded-lg">
                                    <h3 className="font-semibold mb-3">💡 Personalized Recommendations</h3>
                                    <p className="text-sm text-gray-700">
                                        Based on your financial situation, here are our recommendations to improve your financial health.
                                    </p>
                                </div>

                                <div className="space-y-4">
                                    {results.recommendations.map((rec, index) => (
                                        <div key={index} className={`p-4 rounded-lg border ${
                                            rec.priority === 'high' ? 'bg-red-50 border-red-200' :
                                            rec.priority === 'medium' ? 'bg-yellow-50 border-yellow-200' :
                                            'bg-blue-50 border-blue-200'
                                        }`}>
                                            <div className="flex items-start space-x-3">
                                                <div className={`w-2 h-2 rounded-full mt-2 ${
                                                    rec.priority === 'high' ? 'bg-red-500' :
                                                    rec.priority === 'medium' ? 'bg-yellow-500' :
                                                    'bg-blue-500'
                                                }`}></div>
                                                <div>
                                                    <h4 className="font-semibold">{rec.title}</h4>
                                                    <p className="text-sm text-gray-600 mt-1">{rec.description}</p>
                                                    <p className="text-sm font-medium text-blue-600 mt-2">Action: {rec.action}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="flex space-x-3">
                            <Button onClick={onBack} className="bg-gray-500 hover:bg-gray-600">
                                ← Back to Goals
                            </Button>
                            <Button onClick={onRestart} className="bg-green-600 hover:bg-green-700">
                                Start Over
                            </Button>
                        </div>
                    </Card>
                </div>
            );
        };

        // Main App
        function App() {
            const [step, setStep] = useState(1);
            const [financialData, setFinancialData] = useState({
                monthly_income: "",
                current_savings: "",
                emergency_fund_months: "6",
                debts: [],
                expenses: [],
                income_changes: [],
                goals: []
            });

            const nextStep = () => setStep(step + 1);
            const prevStep = () => setStep(step - 1);
            const restart = () => {
                setStep(1);
                setFinancialData({
                    monthly_income: "",
                    current_savings: "",
                    emergency_fund_months: "6",
                    debts: [],
                    expenses: [],
                    income_changes: [],
                    goals: []
                });
            };

            return (
                <div className="container mx-auto px-4 py-8">
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-4xl font-bold text-gray-900 mb-4">
                            💰 Comprehensive Financial Planner
                        </h1>
                        <p className="text-lg text-gray-600 max-w-3xl mx-auto">
                            Plan for real-world scenarios: variable income, savings goals, major purchases, and flexible expenses. 
                            Perfect for self-employed professionals and anyone with changing financial circumstances.
                        </p>
                    </div>

                    {/* Progress Bar */}
                    <div className="max-w-4xl mx-auto mb-8">
                        <div className="flex items-center justify-between">
                            {[1, 2, 3, 4, 5].map((stepNum) => (
                                <React.Fragment key={stepNum}>
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${
                                        step >= stepNum ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-500'
                                    }`}>{stepNum}</div>
                                    {stepNum < 5 && (
                                        <div className={`flex-1 h-1 ${step > stepNum ? 'bg-blue-600' : 'bg-gray-200'}`}></div>
                                    )}
                                </React.Fragment>
                            ))}
                        </div>
                        <div className="flex justify-between mt-2 text-sm text-gray-600">
                            <span>Income</span>
                            <span>Debts</span>
                            <span>Expenses</span>
                            <span>Goals</span>
                            <span>Plan</span>
                        </div>
                    </div>

                    {/* Step Content */}
                    {step === 1 && <Step1Income financialData={financialData} setFinancialData={setFinancialData} onNext={nextStep} />}
                    {step === 2 && <Step2Debts financialData={financialData} setFinancialData={setFinancialData} onNext={nextStep} onBack={prevStep} />}
                    {step === 3 && <Step3Expenses financialData={financialData} setFinancialData={setFinancialData} onNext={nextStep} onBack={prevStep} />}
                    {step === 4 && <Step4Goals financialData={financialData} setFinancialData={setFinancialData} onNext={nextStep} onBack={prevStep} />}
                    {step === 5 && <Step5Results financialData={financialData} onBack={prevStep} onRestart={restart} />}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>